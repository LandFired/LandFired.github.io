<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>磁传感器测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #output {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>磁传感器测试</h1>
    <button id="requestPermission">请求磁传感器权限</button>
    <div id="output"></div>

    <script>
        // 获取页面元素
        const requestPermissionButton = document.getElementById('requestPermission');
        const output = document.getElementById('output');

        // 检查浏览器是否支持磁传感器
        if (!('Magnetometer' in window)) {
            output.textContent = '你的浏览器不支持磁传感器API。';
            requestPermissionButton.disabled = true;
        }

        // 请求权限并初始化磁传感器
        requestPermissionButton.addEventListener('click', async () => {
            try {
                // 检查权限状态
                const permissionStatus = await navigator.permissions.query({ name: 'magnetometer' });
                if (permissionStatus.state === 'granted') {
                    output.textContent = '权限已授予，正在初始化磁传感器...';
                    initMagnetometer();
                } else {
                    output.textContent = '权限未开启，请手动开启磁传感器权限。';
                }
            } catch (error) {
                output.textContent = `权限请求失败：${error.message}`;
            }
        });

        // 初始化磁传感器
        function initMagnetometer() {
            try {
                const magnetometer = new Magnetometer({ frequency: 60 });
                magnetometer.addEventListener('reading', () => {
                    output.textContent = `X: ${magnetometer.x.toFixed(2)}, Y: ${magnetometer.y.toFixed(2)}, Z: ${magnetometer.z.toFixed(2)}`;
                });
                magnetometer.start();
                output.textContent = '磁传感器已启动，正在读取数据...';
            } catch (error) {
                output.textContent = `磁传感器初始化失败：${error.message}`;
            }
        }
    </script>
</body>
</html>